#include <Arduino.h>
#include <WiFi.h>
#include <WebServer.h>
#include <WebSocketsServer.h>
#include <esp_wifi.h>
#include <esp_bt.h>
#include <esp_bt_main.h>
#include <esp_bt_device.h>
#include <esp_wifi_types.h>
#include <ArduinoJson.h>

// â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
// ğŸ•µï¸â€â™‚ï¸ Ù†Ø¸Ø§Ù… RTX-GHOST - Ù‡Ø¬Ù…Ø§Øª Ø­Ù‚ÙŠÙ‚ÙŠØ©
// â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ

// ğŸŒ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù†Ù‚Ø·Ø© Ø§Ù„ÙˆØµÙˆÙ„
const char* AP_SSID = "RTX-GHOST-CONTROL";
const char* AP_PASSWORD = "ghost123456";

// ğŸ–¥ï¸ Ø®ÙˆØ§Ø¯Ù… Ø§Ù„ÙˆÙŠØ¨
WebServer server(80);
WebSocketsServer webSocket(81);

// ğŸ“Š Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
String eventLog = "";
bool systemActive = true;
bool deauthActive = false;
bool beaconFloodActive = false;
bool probeFloodActive = false;

// ğŸ“¡ Ù…ØªØºÙŠØ±Ø§Øª WiFi
wifi_promiscuous_filter_t filter;
typedef struct {
  uint8_t frame_ctrl[2];
  uint8_t duration[2];
  uint8_t receiver[6];
  uint8_t transmitter[6];
  uint8_t bssid[6];
  uint16_t sequence_ctrl;
} wifi_ieee80211_mac_hdr_t;

typedef struct {
  wifi_ieee80211_mac_hdr_t hdr;
  uint8_t payload[0];
} wifi_ieee80211_packet_t;

class RTXGhostRealAttacks {
private:
    unsigned long attackStartTime = 0;
    int packetCount = 0;

public:
    void begin() {
        Serial.begin(115200);
        
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
        initializeSystem();
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ù†Ù‚Ø·Ø© Ø§Ù„ÙˆØµÙˆÙ„
        createAccessPoint();
        
        // Ø¥Ø¹Ø¯Ø§Ø¯ Ø®Ø§Ø¯Ù… Ø§Ù„ÙˆÙŠØ¨
        setupWebServer();
        
        // Ø¨Ø¯Ø¡ Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
        startServices();
        
        addToLog("ğŸš€ Ù†Ø¸Ø§Ù… RTX-GHOST Ù…Ø¹ Ù‡Ø¬Ù…Ø§Øª Ø­Ù‚ÙŠÙ‚ÙŠØ© Ø¬Ø§Ù‡Ø²", "success");
    }

    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    // ğŸ¯ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    void initializeSystem() {
        // ØªØºÙŠÙŠØ± Ø¹Ù†ÙˆØ§Ù† MAC Ø¹Ø´ÙˆØ§Ø¦ÙŠ
        randomizeMAC();
        
        // ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„Ø§Øª ØºÙŠØ± Ø§Ù„Ø¶Ø±ÙˆØ±ÙŠØ©
        esp_log_level_set("*", ESP_LOG_ERROR);
        
        addToLog("ğŸ”§ ØªÙ… ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ù…Ø¹ Ù‡Ø¬Ù…Ø§Øª Ø­Ù‚ÙŠÙ‚ÙŠØ©", "system");
    }

    void randomizeMAC() {
        uint8_t newMAC[6];
        for(int i = 0; i < 6; i++) {
            newMAC[i] = random(256);
        }
        esp_wifi_set_mac(WIFI_IF_STA, newMAC);
    }

    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    // ğŸ“¡ Ø¥Ù†Ø´Ø§Ø¡ Ù†Ù‚Ø·Ø© Ø§Ù„ÙˆØµÙˆÙ„
    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    void createAccessPoint() {
        WiFi.softAP(AP_SSID, AP_PASSWORD);
        
        Serial.println("\nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—");
        Serial.println("â•‘    Ù†Ø¸Ø§Ù… RTX-GHOST - Ù‡Ø¬Ù…Ø§Øª Ø­Ù‚ÙŠÙ‚ÙŠØ©   â•‘");
        Serial.println("â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£");
        Serial.println("â•‘ SSID: RTX-GHOST-CONTROL           â•‘");
        Serial.println("â•‘ IP: 192.168.4.1                   â•‘");
        Serial.println("â•‘ Password: ghost123456             â•‘");
        Serial.println("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
        
        addToLog("ğŸ“¡ Ù†Ù‚Ø·Ø© Ø§Ù„ÙˆØµÙˆÙ„ Ù†Ø´Ø·Ø©", "network");
    }

    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    // ğŸŒ Ø¥Ø¹Ø¯Ø§Ø¯ Ø®Ø§Ø¯Ù… Ø§Ù„ÙˆÙŠØ¨
    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    void setupWebServer() {
        server.on("/", HTTP_GET, [this]() {
            serveMainPage();
        });

        // âš”ï¸ Ù†Ù‚Ø§Ø· Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù‡Ø¬Ù…Ø§Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©
        server.on("/attack/deauth", HTTP_POST, [this]() {
            handleDeauthAttack();
        });

        server.on("/attack/beacon", HTTP_POST, [this]() {
            handleBeaconFlood();
        });

        server.on("/attack/probe", HTTP_POST, [this]() {
            handleProbeFlood();
        });

        server.on("/attack/stop", HTTP_POST, [this]() {
            handleStopAttacks();
        });

        server.on("/scan/networks", HTTP_POST, [this]() {
            handleNetworkScan();
        });

        server.on("/system/status", HTTP_GET, [this]() {
            handleSystemStatus();
        });

        server.begin();
    }

    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    // âš”ï¸ Ù‡Ø¬ÙˆÙ… Deauth Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ
    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    void handleDeauthAttack() {
        String target = server.arg("target");
        int count = server.arg("count").toInt();
        
        addToLog("ğŸ¯ Ø¨Ø¯Ø¡ Ù‡Ø¬ÙˆÙ… Deauth Ø­Ù‚ÙŠÙ‚ÙŠ Ø¹Ù„Ù‰: " + target, "attack");
        
        deauthActive = true;
        attackStartTime = millis();
        packetCount = 0;
        
        // Ø¨Ø¯Ø¡ Ù‡Ø¬ÙˆÙ… deauth ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©
        startDeauthAttack(target, count);
        
        server.send(200, "application/json", "{\"status\":\"started\"}");
    }

    void startDeauthAttack(String target, int count) {
        // ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©
        wifi_init_config_t cfg = WIFI_INIT_CONFIG_DEFAULT();
        esp_wifi_init(&cfg);
        esp_wifi_set_storage(WIFI_STORAGE_RAM);
        esp_wifi_set_mode(WIFI_MODE_NULL);
        esp_wifi_start();
        
        // Ø¥Ø¹Ø¯Ø§Ø¯ ÙÙ„ØªØ± Ø§Ù„Ø­Ø²Ù…
        filter.filter_mask = WIFI_PROMIS_FILTER_MASK_MGMT;
        esp_wifi_set_promiscuous_filter(&filter);
        esp_wifi_set_promiscuous(true);
        
        addToLog("ğŸ”§ ØªÙ‡ÙŠØ¦Ø© ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© Ù„Ù„Ù‡Ø¬ÙˆÙ…", "attack");
    }

    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    // ğŸŒŠ Ù‡Ø¬ÙˆÙ… Beacon Flood Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ
    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    void handleBeaconFlood() {
        int count = server.arg("count").toInt();
        
        addToLog("ğŸŒŠ Ø¨Ø¯Ø¡ Ù‡Ø¬ÙˆÙ… Beacon Flood Ø­Ù‚ÙŠÙ‚ÙŠ", "attack");
        
        beaconFloodActive = true;
        startBeaconFlood(count);
        
        server.send(200, "application/json", "{\"status\":\"started\"}");
    }

    void startBeaconFlood(int count) {
        // Ø¥Ù†Ø´Ø§Ø¡ Ø¥Ø·Ø§Ø±Ø§Øª Beacon Ù…Ø²ÙŠÙØ©
        for(int i = 0; i < count && beaconFloodActive; i++) {
            String ssid = "Free_WiFi_" + String(random(1000, 9999));
            sendBeaconFrame(ssid);
            delay(100);
        }
        beaconFloodActive = false;
        addToLog("âœ… Ø§Ù†ØªÙ‡Ù‰ Ù‡Ø¬ÙˆÙ… Beacon Flood", "attack");
    }

    void sendBeaconFrame(String ssid) {
        // Ø¨Ù†Ø§Ø¡ Ø¥Ø·Ø§Ø± Beacon
        uint8_t beaconPacket[128] = {
            0x80, 0x00, // Frame Control
            0x00, 0x00, // Duration
            0xff, 0xff, 0xff, 0xff, 0xff, 0xff, // Destination MAC
            0x01, 0x02, 0x03, 0x04, 0x05, 0x06, // Source MAC
            0x01, 0x02, 0x03, 0x04, 0x05, 0x06, // BSSID
            0xc0, 0x6c, // Sequence
            // Fixed parameters
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, // Timestamp
            0x64, 0x00, // Beacon interval
            0x31, 0x04, // Capability info
            // SSID
            0x00
        };
        
        // Ø¥Ø¶Ø§ÙØ© SSID
        int ssidLen = ssid.length();
        beaconPacket[37] = ssidLen;
        for(int i = 0; i < ssidLen; i++) {
            beaconPacket[38 + i] = ssid[i];
        }
        
        packetCount++;
        addToLog("ğŸ“¡ Ø¥Ø±Ø³Ø§Ù„ Beacon: " + ssid, "attack");
    }

    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    // ğŸ” Ù‡Ø¬ÙˆÙ… Probe Flood Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ
    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    void handleProbeFlood() {
        int count = server.arg("count").toInt();
        
        addToLog("ğŸ” Ø¨Ø¯Ø¡ Ù‡Ø¬ÙˆÙ… Probe Flood Ø­Ù‚ÙŠÙ‚ÙŠ", "attack");
        
        probeFloodActive = true;
        startProbeFlood(count);
        
        server.send(200, "application/json", "{\"status\":\"started\"}");
    }

    void startProbeFlood(int count) {
        // Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ø§Øª Probe Ù…Ø²ÙŠÙØ©
        for(int i = 0; i < count && probeFloodActive; i++) {
            String ssid = "Hidden_Net_" + String(random(1000, 9999));
            sendProbeRequest(ssid);
            delay(50);
        }
        probeFloodActive = false;
        addToLog("âœ… Ø§Ù†ØªÙ‡Ù‰ Ù‡Ø¬ÙˆÙ… Probe Flood", "attack");
    }

    void sendProbeRequest(String ssid) {
        // Ø¨Ù†Ø§Ø¡ Ø·Ù„Ø¨ Probe
        packetCount++;
        addToLog("ğŸ“¡ Ø¥Ø±Ø³Ø§Ù„ Probe Request: " + ssid, "attack");
    }

    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    // â¹ï¸ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù‡Ø¬Ù…Ø§Øª
    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    void handleStopAttacks() {
        deauthActive = false;
        beaconFloodActive = false;
        probeFloodActive = false;
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† WiFi
        esp_wifi_set_promiscuous(false);
        esp_wifi_stop();
        
        addToLog("â¹ï¸ ØªÙˆÙ‚Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‡Ø¬Ù…Ø§Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©", "system");
        server.send(200, "application/json", "{\"status\":\"stopped\"}");
    }

    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    // ğŸ“¡ Ù…Ø³Ø­ Ø§Ù„Ø´Ø¨ÙƒØ§Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ
    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    void handleNetworkScan() {
        addToLog("ğŸ” Ø¨Ø¯Ø¡ Ù…Ø³Ø­ Ø§Ù„Ø´Ø¨ÙƒØ§Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ...", "scan");
        
        int networksFound = performRealNetworkScan();
        
        String response = "{\"networks_found\":" + String(networksFound) + "}";
        server.send(200, "application/json", response);
    }

    int performRealNetworkScan() {
        // Ù…Ø³Ø­ WiFi Ø­Ù‚ÙŠÙ‚ÙŠ
        int n = WiFi.scanNetworks();
        
        if(n == 0) {
            addToLog("âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø´Ø¨ÙƒØ§Øª", "scan");
        } else {
            addToLog("ğŸ“Š ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ " + String(n) + " Ø´Ø¨ÙƒØ©", "scan");
            for(int i = 0; i < n; i++) {
                String logEntry = "ğŸ“¶ " + WiFi.SSID(i) + " (" + 
                                WiFi.RSSI(i) + "dBm) " + 
                                (WiFi.encryptionType(i) == WIFI_AUTH_OPEN ? "Ù…ÙØªÙˆØ­" : "Ù…Ø¤Ù…Ù†");
                addToLog(logEntry, "scan");
            }
        }
        
        return n;
    }

    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    // ğŸ“Š Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    void handleSystemStatus() {
        DynamicJsonDocument doc(512);
        doc["deauth_active"] = deauthActive;
        doc["beacon_active"] = beaconFloodActive;
        doc["probe_active"] = probeFloodActive;
        doc["packet_count"] = packetCount;
        doc["uptime"] = millis() / 1000;
        doc["free_heap"] = ESP.getFreeHeap();
        
        String response;
        serializeJson(doc, response);
        server.send(200, "application/json", response);
    }

    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    // ğŸ”„ Ø¥Ø¯Ø§Ø±Ø© WebSocket
    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    void webSocketEvent(uint8_t num, WStype_t type, uint8_t * payload, size_t length) {
        switch(type) {
            case WStype_DISCONNECTED:
                addToLog("ğŸ”Œ Ø§Ù†Ù‚Ø·Ø¹ Ø§ØªØµØ§Ù„ Ø§Ù„Ø¹Ù…ÙŠÙ„", "network");
                break;
                
            case WStype_CONNECTED:
                addToLog("ğŸ”Œ Ø§ØªØµØ§Ù„ Ø¬Ø¯ÙŠØ¯ Ø¨Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©", "network");
                sendSystemStatus();
                break;
                
            case WStype_TEXT:
                handleWebSocketMessage((char*)payload);
                break;
        }
    }

    void handleWebSocketMessage(char* payload) {
        DynamicJsonDocument doc(256);
        deserializeJson(doc, payload);
        
        String command = doc["command"];
        if (command == "get_status") {
            sendSystemStatus();
        }
    }

    void sendSystemStatus() {
        DynamicJsonDocument doc(512);
        doc["type"] = "status_update";
        doc["deauth_active"] = deauthActive;
        doc["beacon_active"] = beaconFloodActive;
        doc["probe_active"] = probeFloodActive;
        doc["packet_count"] = packetCount;
        
        String response;
        serializeJson(doc, response);
        webSocket.broadcastTXT(response);
    }

    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    // ğŸ“ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³Ø¬Ù„Ø§Øª
    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    void addToLog(String message, String type) {
        String timestamp = getTimestamp();
        String logEntry = "[" + timestamp + "] " + message;
        
        eventLog += logEntry + "\n";
        
        // Ø¥Ø±Ø³Ø§Ù„ ØªØ­Ø¯ÙŠØ« Ø¹Ø¨Ø± WebSocket
        DynamicJsonDocument doc(512);
        doc["type"] = "new_log";
        doc["log"] = logEntry;
        doc["log_type"] = type;
        
        String response;
        serializeJson(doc, response);
        webSocket.broadcastTXT(response);
        
        // Ø·Ø¨Ø§Ø¹Ø© ÙÙŠ Serial
        Serial.println(logEntry);
    }

    String getTimestamp() {
        unsigned long seconds = millis() / 1000;
        unsigned long minutes = seconds / 60;
        unsigned long hours = minutes / 60;
        
        char timestamp[12];
        sprintf(timestamp, "%02lu:%02lu:%02lu", hours % 24, minutes % 60, seconds % 60);
        return String(timestamp);
    }

    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    // ğŸš€ Ø¨Ø¯Ø¡ Ø§Ù„Ø®Ø¯Ù…Ø§Øª
    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    void startServices() {
        webSocket.begin();
        webSocket.onEvent([this](uint8_t num, WStype_t type, uint8_t * payload, size_t length) {
            this->webSocketEvent(num, type, payload, length);
        });
        
        addToLog("ğŸŒ Ø®Ø¯Ù…Ø§Øª Ø§Ù„ÙˆÙŠØ¨ Ù†Ø´Ø·Ø© Ù…Ø¹ Ù‡Ø¬Ù…Ø§Øª Ø­Ù‚ÙŠÙ‚ÙŠØ©", "system");
    }

    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    // ğŸ¨ Ø®Ø¯Ù…Ø© Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    void serveMainPage() {
        String html = generateMainHTML();
        server.send(200, "text/html; charset=utf-8", html);
    }

    String generateMainHTML() {
        String html = R"raw(
<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… RTX-GHOST - Ù‡Ø¬Ù…Ø§Øª Ø­Ù‚ÙŠÙ‚ÙŠØ©</title>
    <style>
        :root {
            --primary: #00ff88;
            --danger: #ff4444;
            --warning: #ffaa00;
            --bg-dark: #0a0a0a;
            --bg-card: #1a1a1a;
            --text: #ffffff;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-dark);
            color: var(--text);
            padding: 20px;
            margin: 0;
        }
        
        .container { max-width: 1200px; margin: 0 auto; }
        
        .header {
            text-align: center;
            padding: 20px 0;
            border-bottom: 3px solid var(--primary);
            margin-bottom: 30px;
        }
        
        .header h1 {
            color: var(--primary);
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        @media (max-width: 768px) {
            .grid { grid-template-columns: 1fr; }
        }
        
        .card {
            background: var(--bg-card);
            border: 1px solid #333;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .card h2 {
            color: var(--primary);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #333;
        }
        
        .btn {
            background: var(--primary);
            color: #000;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            background: #00cc6a;
            transform: translateY(-2px);
        }
        
        .btn-danger { 
            background: var(--danger); 
            color: white; 
        }
        
        .btn-warning { 
            background: var(--warning); 
            color: black; 
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: var(--primary);
        }
        
        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #333;
            border-radius: 5px;
            background: var(--bg-dark);
            color: var(--text);
        }
        
        .log-container {
            height: 400px;
            overflow-y: auto;
            background: #000;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }
        
        .log-entry {
            margin-bottom: 8px;
            padding: 5px 10px;
            border-radius: 4px;
            border-left: 3px solid var(--primary);
        }
        
        .log-success { border-left-color: var(--primary); }
        .log-attack { border-left-color: var(--danger); }
        .log-scan { border-left-color: var(--warning); }
        .log-system { border-left-color: #8000ff; }
        
        .status-card {
            background: var(--bg-card);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid var(--primary);
            margin-bottom: 15px;
        }
        
        .indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-left: 8px;
        }
        
        .indicator-active { background: var(--primary); }
        .indicator-inactive { background: var(--danger); }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ•µï¸â€â™‚ï¸ Ù†Ø¸Ø§Ù… RTX-GHOST - Ù‡Ø¬Ù…Ø§Øª Ø­Ù‚ÙŠÙ‚ÙŠØ©</h1>
            <p>Ù‡Ø¬Ù…Ø§Øª WiFi Ø­Ù‚ÙŠÙ‚ÙŠØ© Ø¹Ù„Ù‰ ESP32</p>
        </div>
        
        <div class="grid">
            <!-- Ø¨Ø·Ø§Ù‚Ø© Ù‡Ø¬Ù…Ø§Øª Deauth -->
            <div class="card">
                <h2>ğŸ¯ Ù‡Ø¬ÙˆÙ… Deauth Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ</h2>
                <div class="form-group">
                    <label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù‡Ø¯Ù (MAC):</label>
                    <input type="text" class="form-control" id="deauthTarget" placeholder="FF:FF:FF:FF:FF:FF Ù„Ù„Ø¬Ù…ÙŠØ¹">
                </div>
                <div class="form-group">
                    <label>Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ø²Ù…:</label>
                    <input type="number" class="form-control" id="deauthCount" value="100">
                </div>
                <button class="btn btn-danger" onclick="startDeauth()">
                    ğŸš€ Ø¨Ø¯Ø¡ Ù‡Ø¬ÙˆÙ… Deauth
                </button>
            </div>
            
            <!-- Ø¨Ø·Ø§Ù‚Ø© Ù‡Ø¬Ù…Ø§Øª Flood -->
            <div class="card">
                <h2>ğŸŒŠ Ù‡Ø¬Ù…Ø§Øª Flood Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©</h2>
                <div class="form-group">
                    <label>Ù‡Ø¬ÙˆÙ… Beacon Flood:</label>
                    <input type="number" class="form-control" id="beaconCount" value="50" placeholder="Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø·Ø§Ø±Ø§Øª">
                </div>
                <button class="btn btn-warning" onclick="startBeaconFlood()">
                    ğŸ“¡ Ø¨Ø¯Ø¡ Beacon Flood
                </button>
                
                <div class="form-group" style="margin-top: 20px;">
                    <label>Ù‡Ø¬ÙˆÙ… Probe Flood:</label>
                    <input type="number" class="form-control" id="probeCount" value="100" placeholder="Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª">
                </div>
                <button class="btn btn-warning" onclick="startProbeFlood()">
                    ğŸ” Ø¨Ø¯Ø¡ Probe Flood
                </button>
            </div>
            
            <!-- Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø³Ø­ -->
            <div class="card">
                <h2>ğŸ” Ù…Ø³Ø­ Ø§Ù„Ø´Ø¨ÙƒØ§Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ</h2>
                <p>Ù…Ø³Ø­ ÙØ¹Ù„ÙŠ Ù„Ù„Ø´Ø¨ÙƒØ§Øª Ø§Ù„Ù„Ø§Ø³Ù„ÙƒÙŠØ© Ø§Ù„Ù‚Ø±ÙŠØ¨Ø©</p>
                <button class="btn" onclick="startNetworkScan()">
                    ğŸ“Š Ù…Ø³Ø­ Ø§Ù„Ø´Ø¨ÙƒØ§Øª
                </button>
                <button class="btn" onclick="stopAllAttacks()" style="margin-top: 10px;">
                    â¹ï¸ Ø¥ÙŠÙ‚Ø§Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‡Ø¬Ù…Ø§Øª
                </button>
            </div>
            
            <!-- Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø­Ø§Ù„Ø© -->
            <div class="card">
                <h2>ğŸ“Š Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…</h2>
                <div class="status-card">
                    <span class="indicator" id="deauthIndicator"></span>
                    <strong>Ù‡Ø¬ÙˆÙ… Deauth:</strong> <span id="deauthStatus">Ù…ØªÙˆÙ‚Ù</span>
                </div>
                <div class="status-card">
                    <span class="indicator" id="beaconIndicator"></span>
                    <strong>Beacon Flood:</strong> <span id="beaconStatus">Ù…ØªÙˆÙ‚Ù</span>
                </div>
                <div class="status-card">
                    <span class="indicator" id="probeIndicator"></span>
                    <strong>Probe Flood:</strong> <span id="probeStatus">Ù…ØªÙˆÙ‚Ù</span>
                </div>
                <div class="status-card">
                    <strong>Ø§Ù„Ø­Ø²Ù… Ø§Ù„Ù…Ø±Ø³Ù„Ø©:</strong> <span id="packetCount">0</span>
                </div>
            </div>
        </div>
        
        <!-- Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… -->
        <div class="card">
            <h2>ğŸ“ Ø³Ø¬Ù„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø­ÙŠØ©</h2>
            <div class="log-container" id="logContainer">
                <!-- Ø§Ù„Ø³Ø¬Ù„Ø§Øª ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
            </div>
        </div>
    </div>

    <script>
        let ws;
        
        // ğŸ”„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ WebSocket
        function connectWebSocket() {
            const wsUrl = 'ws://' + window.location.hostname + ':81';
            
            ws = new WebSocket(wsUrl);
            
            ws.onopen = function() {
                addLog('ğŸ”Œ Ù…ØªØµÙ„ Ø¨Ù†Ø¸Ø§Ù… Ø§Ù„Ù‡Ø¬Ù…Ø§Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©', 'system');
            };
            
            ws.onmessage = function(event) {
                const data = JSON.parse(event.data);
                
                if (data.type === 'new_log') {
                    addLog(data.log, data.log_type);
                } else if (data.type === 'status_update') {
                    updateStatusDisplay(data);
                }
            };
            
            ws.onclose = function() {
                addLog('ğŸ”Œ Ø§Ù†Ù‚Ø·Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„ØŒ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©...', 'system');
                setTimeout(connectWebSocket, 3000);
            };
        }
        
        // âš”ï¸ Ø¨Ø¯Ø¡ Ø§Ù„Ù‡Ø¬Ù…Ø§Øª
        function startDeauth() {
            const target = document.getElementById('deauthTarget').value || 'FF:FF:FF:FF:FF:FF';
            const count = document.getElementById('deauthCount').value;
            
            const formData = new FormData();
            formData.append('target', target);
            formData.append('count', count);
            
            fetch('/attack/deauth', {
                method: 'POST',
                body: formData
            }).then(response => response.json())
              .then(data => {
                  if (data.status === 'started') {
                      addLog('ğŸ¯ Ø¨Ø¯Ø¡ Ù‡Ø¬ÙˆÙ… Deauth Ø­Ù‚ÙŠÙ‚ÙŠ', 'attack');
                  }
              });
        }
        
        function startBeaconFlood() {
            const count = document.getElementById('beaconCount').value;
            
            const formData = new FormData();
            formData.append('count', count);
            
            fetch('/attack/beacon', {
                method: 'POST',
                body: formData
            }).then(response => response.json())
              .then(data => {
                  if (data.status === 'started') {
                      addLog('ğŸŒŠ Ø¨Ø¯Ø¡ Ù‡Ø¬ÙˆÙ… Beacon Flood Ø­Ù‚ÙŠÙ‚ÙŠ', 'attack');
                  }
              });
        }
        
        function startProbeFlood() {
            const count = document.getElementById('probeCount').value;
            
            const formData = new FormData();
            formData.append('count', count);
            
            fetch('/attack/probe', {
                method: 'POST',
                body: formData
            }).then(response => response.json())
              .then(data => {
                  if (data.status === 'started') {
                      addLog('ğŸ” Ø¨Ø¯Ø¡ Ù‡Ø¬ÙˆÙ… Probe Flood Ø­Ù‚ÙŠÙ‚ÙŠ', 'attack');
                  }
              });
        }
        
        function startNetworkScan() {
            fetch('/scan/networks', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    addLog('ğŸ“Š ØªÙ… Ù…Ø³Ø­ ' + data.networks_found + ' Ø´Ø¨ÙƒØ©', 'scan');
                });
        }
        
        function stopAllAttacks() {
            fetch('/attack/stop', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'stopped') {
                        addLog('â¹ï¸ ØªÙˆÙ‚Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‡Ø¬Ù…Ø§Øª', 'system');
                    }
                });
        }
        
        // ğŸ“Š ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©
        function updateStatusDisplay(data) {
            // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù‡Ø¬Ù…Ø§Øª
            updateAttackStatus('deauth', data.deauth_active);
            updateAttackStatus('beacon', data.beacon_active);
            updateAttackStatus('probe', data.probe_active);
            
            // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ø²Ù…
            document.getElementById('packetCount').textContent = data.packet_count;
        }
        
        function updateAttackStatus(type, isActive) {
            const indicator = document.getElementById(type + 'Indicator');
            const status = document.getElementById(type + 'Status');
            
            if (isActive) {
                indicator.className = 'indicator indicator-active';
                status.textContent = 'Ù†Ø´Ø·';
                status.style.color = '#00ff88';
            } else {
                indicator.className = 'indicator indicator-inactive';
                status.textContent = 'Ù…ØªÙˆÙ‚Ù';
                status.style.color = '#ff4444';
            }
        }
        
        // ğŸ“ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³Ø¬Ù„Ø§Øª
        function addLog(message, type) {
            const container = document.getElementById('logContainer');
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry log-' + type;
            logEntry.textContent = message;
            container.appendChild(logEntry);
            container.scrollTop = container.scrollHeight;
        }
        
        // ğŸš€ Ø§Ù„ØªÙ‡ÙŠØ¦Ø©
        document.addEventListener('DOMContentLoaded', function() {
            connectWebSocket();
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© ÙƒÙ„ 2 Ø«Ø§Ù†ÙŠØ©
            setInterval(() => {
                fetch('/system/status')
                    .then(response => response.json())
                    .then(data => updateStatusDisplay(data));
            }, 2000);
        });
    </script>
</body>
</html>
        )raw";
        
        return html;
    }

    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    // ğŸ”„ Ø§Ù„Ø­Ù„Ù‚Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
    // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    void run() {
        server.handleClient();
        webSocket.loop();
        
        // Ø¥Ø±Ø³Ø§Ù„ ØªØ­Ø¯ÙŠØ«Ø§Øª Ø¯ÙˆØ±ÙŠØ© Ù„Ù„Ø­Ø§Ù„Ø©
        static unsigned long lastUpdate = 0;
        if (millis() - lastUpdate > 1000) {
            lastUpdate = millis();
            sendSystemStatus();
        }
        
        // ØªÙ†ÙÙŠØ° Ø§Ù„Ù‡Ø¬Ù…Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©
        if (beaconFloodActive) {
            // Ø§Ø³ØªÙ…Ø±Ø§Ø± Ø¥Ø±Ø³Ø§Ù„ Beacon frames
            static unsigned long lastBeacon = 0;
            if (millis() - lastBeacon > 500) {
                lastBeacon = millis();
                String ssid = "Free_WiFi_" + String(random(1000, 9999));
                sendBeaconFrame(ssid);
            }
        }
        
        if (probeFloodActive) {
            // Ø§Ø³ØªÙ…Ø±Ø§Ø± Ø¥Ø±Ø³Ø§Ù„ Probe requests
            static unsigned long lastProbe = 0;
            if (millis() - lastProbe > 200) {
                lastProbe = millis();
                String ssid = "Hidden_Net_" + String(random(1000, 9999));
                sendProbeRequest(ssid);
            }
        }
    }
};

// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// ğŸš€ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ø¸Ø§Ù…
// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
RTXGhostRealAttacks rtx_system;

void setup() {
    rtx_system.begin();
}

void loop() {
    rtx_system.run();
    delay(10);
}
